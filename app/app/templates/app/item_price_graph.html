<!-- item_price_graph.html -->
<!DOCTYPE html>
<html>
    {% load static %}
    <head>
        <title>Item Price Graph</title>
        <link rel="stylesheet" href="{% static 'style.css' %}">
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    </head>
        <header>
            <a href="{% url 'home' %}" class ="header-btn">Home</a>
            <a href="{% url 'track_price' %}" class ="header-btn">Track Price</a>
            <a href="{% url 'item_price_graph' %}" class ="header-btn">Item Price Graph</a>
            <a href="{% url 'list_items' %}" class ="header-btn">Item List</a>
            <a href="{% url 'bulk_track' %}" class ="header-btn">Bulk Track</a>
            <a href="{% url 'admin:index' %}" class ="header-btn">Admin</a>

        </header>
<body>
    <h1>Item Price Graph</h1>

    <form method="GET">
    {% csrf_token %}
    {{ form }} <input type="submit" value="Show Graph">
    </form>
    <div>
        <!-- Display the graph using the base64 encoded data -->
        <img src="data:image/png;base64,{{ plot_data }}" alt="Price History Graph">
    </div>
    <script>
        $(document).ready(function () {
            // On change of item_category field, update the item options based on selected category
            $('#id_item_category').change(function () {
                var category = $(this).val();

                // AJAX request to fetch items based on selected category
                $.ajax({
                    url: '{% url "get_items_by_category" %}',
                    data: {
                        category: category
                    },
                    dataType: 'json',
                    success: function (data) {
                        $('#id_item_id').empty(); // Clear current options

                        // Add fetched items as options for item_id field
                        $.each(data.items, function (key, value) {
                            $('#id_item_id').append('<option value="' + key + '">' + value + '</option>');
                        });
                    }
                });
            });
        });
    </script>

</body>

</html>
